# Configuration for the RPi Sensor Streamer

[app]
data-producer-loop-ms = 100

[app.topics]
lidar-tof050c = "lidar/tof050c"
imu-1 = "imu/1"

[zeromq]
data-publisher-address = "tcp://127.0.0.1:5559"

[server]
web_port = 8080
bind_ip = "0.0.0.0"
pi_ip = "" # Auto-detected if empty
allowed_origins = ["*"] # CORS allowed origins (* for all, or specific origins)

[webrtc]
# STUN servers for NAT traversal (can specify multiple)
stun_servers = ["stun:stun.l.google.com:19302"]
# TURN servers for restrictive NATs (optional)
turn_servers = []
turn_username = ""
turn_credential = ""
# Maximum number of concurrent clients per camera
max_clients = 4
# MTU size for RTP packets
mtu = 1200
# WebRTC latency in milliseconds (affects timing calculations)
latency = 200
# Network timeout for WebRTC connections (milliseconds)
timeout = 10000

[video]
# Primary codec configuration - used by both capture and WebRTC
codec = "h264" # Options: "vp8" or "h264"
encoder-preset = "ultrafast" # For h264: ultrafast, fast, medium, slow
keyframe-interval = 30 # Keyframe interval in frames
cpu-used = 8 # CPU usage setting for VP8 (higher = faster, lower quality)
bitrate = 2000000 # Target bitrate in bits per second

[camera1]
device = "/base/axi/pcie@1000120000/rp1/i2c@88000/imx219@10"
width = 640
height = 480
target-width = 640
target-height = 480
fps = 30
webrtc_port = 5557
flip_method = "vertical-flip"

[camera1.crop]
x = 0
y = 0
width = 640
height = 480

[camera2]
device = "/base/axi/pcie@1000120000/rp1/i2c@80000/imx219@10"
width = 640
height = 480
target-width = 640
target-height = 480
fps = 30
webrtc_port = 5558
flip_method = "vertical-flip"

[camera2.crop]
x = 0
y = 0
width = 640
height = 480

[lidar-tof050c]
i2c-bus = 1
enable-pin = 17 # GPIO17

[lidar-tof400c]
i2c-bus = 1
enable-pin = 27 # GPIO27
new-i2c-address = 0x2A

[imu-1]
i2c-bus = 0
address = 0x68

# Buffer sizes for channels and queues
[buffers]
frame_channel_size = 30      # Buffer size for frame channels
encoded_channel_size = 20    # Buffer size for encoded video channels
signal_channel_size = 1      # Buffer size for signal channels
error_channel_size = 1       # Buffer size for error channels

# Timeout and delay settings
[timeouts]
webrtc_startup_delay_ms = 2000      # Delay before starting cameras after WebRTC servers
camera_startup_delay_ms = 1000      # Delay between starting cameras
encoder_sleep_interval_ms = 10      # Sleep interval for encoder loop
shutdown_timeout_seconds = 30       # Timeout for graceful shutdown
http_shutdown_timeout_seconds = 5   # Timeout for HTTP server shutdown

# Logging configuration
[logging]
frame_log_interval = 30             # Log every N frames (0 to disable)
stats_log_interval_seconds = 60     # Interval for stats logging

# Resource limits
[limits]
max_memory_usage_mb = 512           # Maximum memory usage before alert
max_log_files = 20                  # Maximum number of log files to keep
max_payload_size_mb = 2             # Maximum payload size for video frames

# GStreamer debug configuration for memory leak detection
[debug]
enable_memory_monitoring = true
memory_check_interval_seconds = 60
max_memory_usage_mb = 512  # Alert if memory exceeds this limit
gst_debug_level = 2  # Reduced from default to minimize overhead 